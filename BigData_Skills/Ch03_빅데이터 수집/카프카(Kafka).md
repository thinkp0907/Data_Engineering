# 빅데이터 수집

## 빅데이터 수집에 활용할 기술

### 카프카

#### 카프카 소개

카프카(Kafka)는 MOM(Message Oriented Middleware) 소프트웨어 중 하나로서 대규모로 발생하는 메시징성 데이터를 **비동기 방식으로 중계**하는 역할을 한다. 

원천 시스템으로부터 대규모 트랜잭션 데이터가 발생했을 때 중간에 데이터를 버퍼링하면서 타깃 시스템에 안정적으로 전송해 주는 중간 시스템 기능과 아키텍처를 제공한다.

| 주요 구성 요소 | 설명                                                         |
| -------------- | ------------------------------------------------------------ |
| Broker         | 카프카의 서비스 인스턴스로서, 다수의 Broker를 클러스터로 구성하고 Topic이 생성 되는 물리적 서버 |
| Topic          | Broker에서 데이터의 발행/소비 처리를 위한 저장소             |
| Provider       | Broker의 특정 Topic에 데이터를 전송(발행)하는 역할로서 애플리케이션에서 카프카 라이브러리를 이용해 구현 |
| Consumer       | Broker의 특정 Topic에서 데이터를 수신(소비)하는 역할로서 애플리케이션에서 카프카 라이브러리를 이용해 구현 |



### 카프카 아키텍처

카프카는 클러스터 방식에 따라 세 가지 아키텍처 구성이 가능하며, 이때 **주키퍼**를 반드시 이용해야 한다.

![image-20210408115650438](C:\Users\Chorlock\AppData\Roaming\Typora\typora-user-images\image-20210408115650438.png)

**[카프카 아키텍처 유형1 - 싱글 브로커/싱글 노드]**

**카프카 아키텍처 유형1**은 1대의 카프카 서버만 설치하고, 1개의 Broker만 구성한 아키텍처다. 대량의 발행/소비 요건이 없고, 업무 도메인이 단순할 때 이용한다.

![image-20210408120918091](C:\Users\Chorlock\AppData\Roaming\Typora\typora-user-images\image-20210408120918091.png)

**[카프카 아키텍처 유형2 - 멀티 브로커/싱글 노드]**

**카프카 아키텍처 유형2**는 1대의 카프카 서버에 2개의 Broker를 구성한 아키텍처다. 물리적인 카프카 서버가 1대 이므로 역시 대량의 발행/소비 요건에는 사용하기 어렵지만 **업무 도메인이 복잡해서 메시지 처리를 분리 관리**해야 할 때 이용한다

![image-20210408121549546](C:\Users\Chorlock\AppData\Roaming\Typora\typora-user-images\image-20210408121549546.png)

**[카프카 아키텍처 유형3 - 멀티 브로커/멀티 노드]**

마지막 아키텍처는 2대 이상의 카프카 서버로 멀티 브로커를 만들었다. 대규모 발행/소비 데이터 처리에 적합하며, 물리적으로 나눠진 브로커 간의 데이터 복제가 가능해 안정성이 높다. 또한 업무 도메인별 메시지 그룹을 분류할 수 있어 복잡한 메시지 송/수신에 활용하며 적합하다.



### 카프카 활용 방안

이번 파일럿 프로젝트 **'스마트카'**에서 카프카의 역할은 단순하다. **플럼(Flume)**이 실시간 데이터를 수집해 카프카 토픽에 전송하면 카프카는 전송받은 데이터를 토픽에 임시로 저장하고 있다가 컨슈머 프로그램이 작동해 토픽에서 데이터를 가져간다.

![image-20210408134351758](C:\Users\Chorlock\AppData\Roaming\Typora\typora-user-images\image-20210408134351758.png)

**['스마트카'에서 카프카 활용 방안1]**



카프카를 활용하는 **목적**은 플럼이 아주 빠르게 발생하는 데이터를 실시간으로 수집하게 되면 이를 **최종 목적지에 전달하기 전 중간에서 안정적인 버퍼링 처리**가 필요해서다. 스마트카 운전자의 운행 정보는 100명이 1초 간격으로 동시에 발생시키는, 속도가 매우 빠른 데이터로서 플럼 입장에서 수집이 부담스럽다. 이때 카프카와 같은 분산 환경의 대규모 중간 저장소가 완충 역할을 함으로써 안정적인 수집 아키텍처를 구성할 수 있다.



카프카를 대규모 분산 환경으로 구성했는데, HBase 장애가 발생해도 카프카에서 데이터를 저장해 놓았다가 HBase가 복구되면 곧바로 재처리가 가능해진다. 또한 플럼이 수집한 데이터를 카프카의 토픽에 비동기로 전송함으로써 수집 속도가 빨라지는 장점도 있다.

![image-20210408140045755](C:\Users\Chorlock\AppData\Roaming\Typora\typora-user-images\image-20210408140045755.png)

**['스마트카'에서 카프카 활용 방안2]**



