# 빅데이터 적재 Ⅱ - 실시간 로그/분석 적재

## 빅데이터 실시간 적재 개요

적재 1부 - 대용량 로그 파일 적재는 **큰 파일을 하둡에 장기간 저장해 놓고** 대규모 배치 작업과 분석에 이용된다. 이번 2부 - 실시간 로그/분석 적재 에서는 **작지만 대량으로 발생하는 메시지성 데이터를 실시간으로 분석** 처리하며, 해당 결과를 인메모리에 저장해 주변 시스템과 빠르게 공유한다.

대량의 메시지 데이터를 영구 저장하기 위해 하둡을 직접 이용하지 않는다. 그 이유로는 유입된 작은 메시지 한 건을 곧바로 하둡에 저장할 경우 한 개의 HDFS파일이 생성되는데, **초당 수천 건의 트랜잭션이 발생하는 메시지의 경우 파일 개수가 기하급수적으로 늘어나구 하둡 클러스터에 오버헤드가 발생**하기 때문이다.

그렇기 때문에, 중간에 메시지를 특정 크기로 모았다가 한꺼번에 적재하거나 대규모 트랜잭션 데이터를 처리하는 데 최적화된 칼럼 지향형 **NoSQL 데이터베이스** 를 주로 사용한다.



### 빅데이터 실시간 적재에 활용하는 기술

#### HBase

HBase는 하둡 기반의 Column-Oriented NoSQL 데이터베이스로서 스키마 변경이 자유롭고, 리전이라는 수십 ~ 수백 대의 분산 서버로 샤딩과 복제 등의 기능을 지원해 성능과 안정성을 보장하는 특징을 띠고 있다.

특히 하둡의 확장성과 내고장성을 그대로 이용할 수 있어 대규모 실시간 데이터 처리를 위한 스피드 레이어 저장소에 HBase가 주로 사용된다



| 주요 구성 요소 | 설명                                                         |
| -------------- | ------------------------------------------------------------ |
| HTable         | 칼럼 기반 데이터 구조를 정의한 테이블로서, 공통점이 있는 칼럼들의 그룹을 묶은 칼럼 패밀리와 테이블의 로우를 식별해서 접근하기 위한 로우키로 구성 |
| HMaster        | HRegion 서버를 관리하며, HRegion들이 속한 HRegion 서버의 메타 정보를 관리 |
| HRegion        | HTable의 크기에 따라 자동으로 수평 분할이 발생하고, 이때 분활된 블록을 HRegion 단위로 지정 |
| HRegionServer  | 분산 노드별 HRegionServer가 구성되며, 하나의 HRegionServer에는 다수의 HRegion이 생성되어 HRegion을 관리 |
| Store          | 하나의 Store에는 칼럼 패밀리가 저장 및 관리되며, MemStore와 HFile로 구성됨 |
| MemStore       | Store 내의 데이터를 인메모리에 저장 및 관리하는 데이터 캐시 영역 |
| HFile          | Store 내의 데이터를 스토리지에 저장 및 관리하는 영구 저장 영역 |

**[HBase의 기본 요소]**



#### HBase 아키텍처

- 하둡의 HDFS를 기반으로 설치 및 구성
- 클라이언트가 주키퍼를 통해 HTable의 기본 정보와 해당 HRegion의 정보 파악
- 정보를 기반으로 클라이언트가 직접 HRegionServer로 연결되어 MemStore에 데이터를 저장
- MemStore에 저장된 데이터는 특정 시점이 되면 HFile로 HDFS에 플러시 된다.
- HFile은 HRegion의 상황에 따라 최적의 HFile로 재구성되는 작업이 이뤄진다.

![image-20210416150852000](https://github.com/thinkp0907/Data_Engineering/blob/main/BigData_Skills/img/HBase%20%EC%95%84%ED%82%A4%ED%85%8D%EC%B2%98.PNG)

**[HBase 아키텍처]**

>  ##### HBase에서 특정 데이터를 가져오는 과정
>
> 1. 주키퍼를 통해 로우키(RowKey)에 해당하는 데이터의 위치 정보를 알아낸다
> 2. 해당 HRegionServer의 Memory 영역인 MemStore에서 데이터를 가져옴으로 디스크 I/O를 최소화(빠른 응답 속도)
> 3. 데이터가 MemStore에서 플러시되어 존재하지 않으면 HFile 영역으로 이동해 데이터 Search
>    - 이때 HBase와 HDFS 사이의 모든 데이터 스트림 라인들은 항상 열려 있으므로 레이턴시 발생 x



#### HBase 활용 방안

수집 영역 개발에서 플럼을 이용해 수집한 스마트카 운전자의 운행 정보를 카프카까지 전송했다. 이번에는 카프카에 저장돼 있는 데이터를 **스톰이** 받아서 HBase의 테이블에 모두 적재한다. 또한 HBase에 저장된 스마트카 운전자의 운행 정보를 **특정 조건에 따라 필터링해서 신속하게 조회**해 보고, 하이브 핸들러를 이용해 HBase에 저장된 데이터와 하이브 데이터를 동시에 활용해 본다.

![image-20210416152826905](https://github.com/thinkp0907/Data_Engineering/blob/main/BigData_Skills/img/%ED%8C%8C%EC%9D%BC%EB%9F%BF%20%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8%EC%97%90%EC%84%9C%EC%9D%98%20HBase%20%ED%99%9C%EC%9A%A9%20%EB%B0%A9%EC%95%88.PNG)

**[파일럿 프로젝트에서의 HBase 활용방안]**



